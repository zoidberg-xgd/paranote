version: '3.8'

services:
  paranote:
    container_name: paranote
    build: .
    ports:
      - "4000:4000"
    volumes:
      # 持久化评论数据
      - ./data:/app/data
      # 可选：挂载 puppeteer 用户数据，保留登录状态
      # - ./puppeteer_data:/app/puppeteer_data
    environment:
      - NODE_ENV=production
      - PUPPETEER_HEADLESS=true
      # --- 高级配置 ---
      # 禁用 Puppeteer 以节省内存 (如果你不需要绕过 Cloudflare)
      # - ENABLE_PUPPETEER=false
      # 切换到 MongoDB 存储 (适合 Render/Zeabur 等无持久化平台)
      # - STORAGE_TYPE=mongo
      # - MONGO_URI=mongodb+srv://user:pass@host/db
      # 配置站点密钥 (JSON 格式)
      # - SITE_SECRETS={"default-site":"change-me-secret"}
    restart: always
    # 限制资源，防止 Puppeteer 占用过多内存
    deploy:
      resources:
        limits:
          memory: 1G
