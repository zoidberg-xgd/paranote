<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ParaNote API æ–‡æ¡£</title>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, monospace;
            max-width: 900px;
            margin: 0 auto;
            padding: 30px 20px;
            background: #fff;
            color: #333;
            line-height: 1.6;
        }
        h1 { border-bottom: 2px solid #f56c6c; padding-bottom: 10px; }
        h2 { margin-top: 40px; color: #f56c6c; }
        h3 { margin-top: 25px; }
        code { background: #f4f4f4; padding: 2px 6px; border-radius: 3px; font-size: 14px; }
        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 13px;
        }
        pre code { background: none; padding: 0; color: inherit; }
        table { width: 100%; border-collapse: collapse; margin: 15px 0; font-size: 14px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background: #f9f9f9; }
        .method { 
            display: inline-block; 
            padding: 3px 8px; 
            border-radius: 3px; 
            font-size: 12px; 
            font-weight: bold;
            margin-right: 8px;
        }
        .get { background: #61affe; color: #fff; }
        .post { background: #49cc90; color: #fff; }
        .delete { background: #f93e3e; color: #fff; }
        .endpoint { font-family: monospace; font-size: 15px; }
        .nav { margin-bottom: 30px; font-size: 14px; }
        .nav a { color: #f56c6c; margin-right: 15px; text-decoration: none; }
        .nav a:hover { text-decoration: underline; }
        .note { background: #fff3cd; border-left: 4px solid #ffc107; padding: 10px 15px; margin: 15px 0; }
        .section { margin-bottom: 50px; }
    </style>
</head>
<body>
    <h1>ğŸ“ ParaNote API æ–‡æ¡£</h1>
    
    <div class="nav">
        <a href="/">é¦–é¡µ</a>
        <a href="#comments">è¯„è®º API</a>
        <a href="#fetch">æŠ“å– API</a>
        <a href="#admin">ç®¡ç† API</a>
        <a href="#integration">é›†æˆ</a>
    </div>

    <!-- è¯„è®º API -->
    <div class="section" id="comments">
        <h2>è¯„è®º API</h2>
        
        <h3><span class="method get">GET</span><span class="endpoint">/api/v1/comments</span></h3>
        <p>è·å–æŒ‡å®šç« èŠ‚çš„æ‰€æœ‰è¯„è®º</p>
        
        <h4>Query å‚æ•°</h4>
        <table>
            <tr><th>å‚æ•°</th><th>å¿…å¡«</th><th>è¯´æ˜</th></tr>
            <tr><td><code>siteId</code></td><td>æ˜¯</td><td>ç«™ç‚¹ ID</td></tr>
            <tr><td><code>workId</code></td><td>æ˜¯</td><td>ä½œå“/æ–‡ç«  ID</td></tr>
            <tr><td><code>chapterId</code></td><td>æ˜¯</td><td>ç« èŠ‚ ID</td></tr>
        </table>
        
        <h4>è¯·æ±‚ç¤ºä¾‹</h4>
        <pre><code>curl "http://localhost:4000/api/v1/comments?siteId=my-site&workId=article-1&chapterId=ch-1"</code></pre>
        
        <h4>å“åº”</h4>
        <pre><code>{
  "commentsByPara": {
    "0": [
      {
        "id": "abc123",
        "content": "è¯„è®ºå†…å®¹",
        "userName": "ç”¨æˆ·å",
        "userId": "user-id",
        "likes": 5,
        "createdAt": "2024-01-01T00:00:00.000Z"
      }
    ],
    "3": [...]
  }
}</code></pre>

        <hr>

        <h3><span class="method post">POST</span><span class="endpoint">/api/v1/comments</span></h3>
        <p>å‘å¸ƒæ–°è¯„è®º</p>
        
        <h4>Body å‚æ•° (JSON)</h4>
        <table>
            <tr><th>å‚æ•°</th><th>å¿…å¡«</th><th>è¯´æ˜</th></tr>
            <tr><td><code>siteId</code></td><td>æ˜¯</td><td>ç«™ç‚¹ ID</td></tr>
            <tr><td><code>workId</code></td><td>æ˜¯</td><td>ä½œå“/æ–‡ç«  ID</td></tr>
            <tr><td><code>chapterId</code></td><td>æ˜¯</td><td>ç« èŠ‚ ID</td></tr>
            <tr><td><code>paraIndex</code></td><td>æ˜¯</td><td>æ®µè½ç´¢å¼• (ä» 0 å¼€å§‹)</td></tr>
            <tr><td><code>content</code></td><td>æ˜¯</td><td>è¯„è®ºå†…å®¹ (1-1000 å­—ç¬¦)</td></tr>
            <tr><td><code>contextText</code></td><td>å¦</td><td>æ®µè½ä¸Šä¸‹æ–‡ (ç”¨äºæ¨¡ç³Šå®šä½)</td></tr>
            <tr><td><code>parentId</code></td><td>å¦</td><td>çˆ¶è¯„è®º ID (ç”¨äºå›å¤)</td></tr>
        </table>
        
        <div class="note">
            <strong>åŒ¿åç”¨æˆ·ï¼š</strong>æœªæä¾› JWT æ—¶ï¼Œç³»ç»Ÿä¼šæ ¹æ® IP è‡ªåŠ¨ç”Ÿæˆç¨³å®šçš„è®¿å®¢èº«ä»½ (å¦‚ <code>è®¿å®¢-a1b2c3</code>)ã€‚
        </div>
        
        <h4>è¯·æ±‚ç¤ºä¾‹</h4>
        <pre><code># å‘å¸ƒè¯„è®º
curl -X POST http://localhost:4000/api/v1/comments \
  -H "Content-Type: application/json" \
  -d '{
    "siteId": "my-site",
    "workId": "article-1",
    "chapterId": "ch-1",
    "paraIndex": 0,
    "content": "è¿™æ®µå†™å¾—çœŸå¥½ï¼"
  }'

# å›å¤è¯„è®º
curl -X POST http://localhost:4000/api/v1/comments \
  -H "Content-Type: application/json" \
  -d '{
    "siteId": "my-site",
    "workId": "article-1",
    "chapterId": "ch-1",
    "paraIndex": 0,
    "content": "åŒæ„ï¼",
    "parentId": "abc123"
  }'</code></pre>

        <hr>

        <h3><span class="method post">POST</span><span class="endpoint">/api/v1/comments/like</span></h3>
        <p>ç‚¹èµè¯„è®º</p>
        
        <h4>Body å‚æ•° (JSON)</h4>
        <table>
            <tr><th>å‚æ•°</th><th>å¿…å¡«</th><th>è¯´æ˜</th></tr>
            <tr><td><code>siteId</code></td><td>æ˜¯</td><td>ç«™ç‚¹ ID</td></tr>
            <tr><td><code>workId</code></td><td>æ˜¯</td><td>ä½œå“/æ–‡ç«  ID</td></tr>
            <tr><td><code>chapterId</code></td><td>æ˜¯</td><td>ç« èŠ‚ ID</td></tr>
            <tr><td><code>commentId</code></td><td>æ˜¯</td><td>è¯„è®º ID</td></tr>
        </table>
        
        <pre><code>curl -X POST http://localhost:4000/api/v1/comments/like \
  -H "Content-Type: application/json" \
  -d '{"siteId":"my-site","workId":"article-1","chapterId":"ch-1","commentId":"abc123"}'</code></pre>

        <hr>

        <h3><span class="method delete">DELETE</span><span class="endpoint">/api/v1/comments</span></h3>
        <p>åˆ é™¤è¯„è®º (éœ€è¦æ˜¯è¯„è®ºä½œè€…æˆ–ç®¡ç†å‘˜)</p>
        
        <h4>Body å‚æ•° (JSON)</h4>
        <table>
            <tr><th>å‚æ•°</th><th>å¿…å¡«</th><th>è¯´æ˜</th></tr>
            <tr><td><code>siteId</code></td><td>æ˜¯</td><td>ç«™ç‚¹ ID</td></tr>
            <tr><td><code>workId</code></td><td>æ˜¯</td><td>ä½œå“/æ–‡ç«  ID</td></tr>
            <tr><td><code>chapterId</code></td><td>æ˜¯</td><td>ç« èŠ‚ ID</td></tr>
            <tr><td><code>commentId</code></td><td>æ˜¯</td><td>è¯„è®º ID</td></tr>
        </table>
    </div>

    <!-- æŠ“å– API -->
    <div class="section" id="fetch">
        <h2>æŠ“å– API</h2>
        
        <h3><span class="method get">GET</span><span class="endpoint">/api/v1/fetch</span></h3>
        <p>æŠ“å–å¹¶è§£æç½‘é¡µå†…å®¹</p>
        
        <h4>Query å‚æ•°</h4>
        <table>
            <tr><th>å‚æ•°</th><th>å¿…å¡«</th><th>è¯´æ˜</th></tr>
            <tr><td><code>url</code></td><td>æ˜¯</td><td>ç›®æ ‡ç½‘é¡µ URL</td></tr>
            <tr><td><code>mode</code></td><td>å¦</td><td><code>reader</code> (é»˜è®¤) æˆ– <code>raw</code></td></tr>
        </table>
        
        <h4>è¯·æ±‚ç¤ºä¾‹</h4>
        <pre><code># çº¯å‡€é˜…è¯»æ¨¡å¼ (æå–æ­£æ–‡)
curl "http://localhost:4000/api/v1/fetch?url=https://example.com/article&mode=reader"

# åŸæ ·æ¨¡å¼ (ä¿ç•™åŸå§‹ HTML)
curl "http://localhost:4000/api/v1/fetch?url=https://example.com/article&mode=raw"</code></pre>
        
        <h4>å“åº”</h4>
        <pre><code>{
  "title": "æ–‡ç« æ ‡é¢˜",
  "content": "&lt;p&gt;æ­£æ–‡å†…å®¹...&lt;/p&gt;",
  "byline": "ä½œè€…",
  "siteName": "example.com",
  "sourceUrl": "https://example.com/article",
  "workId": "r_xxx",
  "siteId": "paranote-reader",
  "chapterId": "index",
  "mode": "reader"
}</code></pre>

        <div class="note">
            <strong>åçˆ¬æœºåˆ¶ï¼š</strong>ä½¿ç”¨ BrowserForge æ™ºèƒ½æŒ‡çº¹ï¼Œè‡ªåŠ¨ç”ŸæˆçœŸå®çš„æµè§ˆå™¨å¤´ã€‚é‡åˆ° Cloudflare æ—¶è‡ªåŠ¨é™çº§åˆ° Puppeteerã€‚
        </div>
    </div>

    <!-- ç®¡ç† API -->
    <div class="section" id="admin">
        <h2>ç®¡ç† API</h2>
        <p>éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦ <code>x-admin-secret</code>ï¼Œå€¼ä¸ºç¯å¢ƒå˜é‡ <code>ADMIN_SECRET</code>ã€‚</p>
        
        <h3><span class="method get">GET</span><span class="endpoint">/api/v1/export</span></h3>
        <p>å¯¼å‡ºæ‰€æœ‰è¯„è®ºæ•°æ®</p>
        <pre><code>curl -H "x-admin-secret: YOUR_SECRET" http://localhost:4000/api/v1/export -o backup.json</code></pre>

        <h3><span class="method post">POST</span><span class="endpoint">/api/v1/import</span></h3>
        <p>å¯¼å…¥è¯„è®ºæ•°æ®</p>
        <pre><code>curl -X POST -H "x-admin-secret: YOUR_SECRET" \
  -H "Content-Type: application/json" \
  -d @backup.json http://localhost:4000/api/v1/import</code></pre>
    </div>

    <!-- é›†æˆ -->
    <div class="section" id="integration">
        <h2>é›†æˆæ–¹å¼</h2>
        
        <h3>æ–¹å¼ä¸€ï¼šåµŒå…¥è„šæœ¬</h3>
        <p>åœ¨ä½ çš„ç½‘é¡µä¸­æ·»åŠ ï¼š</p>
        <pre><code>&lt;!-- æ ‡è®°å†…å®¹åŒºåŸŸ --&gt;
&lt;article data-na-root data-site-id="my-site" data-work-id="article-1" data-chapter-id="ch-1"&gt;
  &lt;p&gt;æ®µè½å†…å®¹...&lt;/p&gt;
&lt;/article&gt;

&lt;!-- å¼•å…¥è„šæœ¬ --&gt;
&lt;script src="http://your-server/embed.js" data-site-id="my-site"&gt;&lt;/script&gt;</code></pre>

        <h3>æ–¹å¼äºŒï¼šè‡ªåŠ¨åŠ è½½å™¨</h3>
        <pre><code>&lt;script src="http://your-server/loader.js" data-site-id="my-site"&gt;&lt;/script&gt;</code></pre>
        <p>è‡ªåŠ¨æ£€æµ‹ <code>article</code>, <code>.content</code>, <code>.post</code> ç­‰å®¹å™¨ã€‚</p>

        <h3>æ–¹å¼ä¸‰ï¼šæ²¹çŒ´è„šæœ¬</h3>
        <p>è®¿é—® <a href="/paranote.user.js">/paranote.user.js</a> å®‰è£…ï¼Œç„¶ååœ¨ä»»æ„ç½‘ç«™æŒ‰ <code>Alt+P</code> å¯ç”¨ã€‚</p>

        <h3>JWT ç”¨æˆ·è®¤è¯</h3>
        <p>åœ¨é¡µé¢ä¸­è®¾ç½® Tokenï¼š</p>
        <pre><code>&lt;script&gt;
window.PARANOTE_TOKEN = jwt.sign({
  siteId: 'my-site',
  sub: 'user-123',
  name: 'ç”¨æˆ·å',
  role: 'admin'  // å¯é€‰ï¼Œç®¡ç†å‘˜å¯åˆ é™¤ä»»æ„è¯„è®º
}, 'YOUR_SITE_SECRET');
&lt;/script&gt;</code></pre>
        
        <p>æœåŠ¡ç«¯é…ç½® <code>SITE_SECRETS</code> ç¯å¢ƒå˜é‡ï¼š</p>
        <pre><code>SITE_SECRETS='{"my-site":"YOUR_SITE_SECRET"}'</code></pre>
    </div>

    <!-- éƒ¨ç½² -->
    <div class="section">
        <h2>éƒ¨ç½²</h2>
        
        <h3>ç¯å¢ƒå˜é‡</h3>
        <table>
            <tr><th>å˜é‡</th><th>é»˜è®¤å€¼</th><th>è¯´æ˜</th></tr>
            <tr><td><code>PORT</code></td><td>4000</td><td>æœåŠ¡ç«¯å£</td></tr>
            <tr><td><code>DEPLOY_MODE</code></td><td>full</td><td>full / api / reader</td></tr>
            <tr><td><code>STORAGE_TYPE</code></td><td>file</td><td>file / mongo</td></tr>
            <tr><td><code>MONGO_URI</code></td><td>-</td><td>MongoDB è¿æ¥å­—ç¬¦ä¸²</td></tr>
            <tr><td><code>ADMIN_SECRET</code></td><td>-</td><td>ç®¡ç†å‘˜å¯†é’¥</td></tr>
            <tr><td><code>SITE_SECRETS</code></td><td>{}</td><td>JWT å¯†é’¥ (JSON)</td></tr>
            <tr><td><code>ENABLE_PUPPETEER</code></td><td>true</td><td>å¯ç”¨ Puppeteer</td></tr>
        </table>

        <h3>Docker</h3>
        <pre><code>docker run -d -p 4000:4000 -v ./data:/app/data zoidberg-xgd/paranote</code></pre>
    </div>

</body>
</html>
